<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <link rel="stylesheet" href="animation_style.css" type="text/css" />
    <title>チェインディスプレイのサンプル</title>
</head>

<!-- <script src="index.js"></script> -->

<body>
    <div>チェインディスプレイのサンプル<a href="../index.html">ストックルームのトップに戻る</a></div>
    <input type="submit" id="add-btn" value="追加"><br>
    <input type="submit" id="reset-btn" value="リセット"><br>
    <div id="display"></div>
    <textarea id="k-area" rows="4" cols="40">
われわれは
宇宙人だ
友好するために
やってきた
    </textarea><br>
</body>

<script type="text/javascript">
    var target = document.getElementById('k-area');
    var display = document.getElementById('display');

    var add_btn = document.getElementById("add-btn");
    add_btn.addEventListener("click",function (){

        var i = 0;
        var messages = getTargetArray();
        chainDisplay(i,messages);

    });

    function chainDisplay(i,messages) {
            if(messages.length <= i) {
                return;
            }
            setTimeout(function( i, messages) {
                var message ="<div class=\"message\">" + messages[i] + "</div>\n";
                display.insertAdjacentHTML("afterbegin",message);
                i++;
                chainDisplay(i,messages);
            },1000,i,messages);
    }

    var reset_btn = document.getElementById("reset-btn");
    reset_btn.addEventListener("click",function(){
        display.innerHTML = "";
    });


 //データを取得するための抽象化するための関数
function getTargetArray(){
    //この行で取得先を変えるようにして、呼び出し元から取得先を隠蔽する
    var messages = getLineItemFromTextArea(target);

   return messages; 
}

function getLineItemFromTextArea(targetTextArea){
    var targetText = targetTextArea.value.replace(/\r\n|\r/g, "\n");
    var lines = targetText.split('\n');
    var linesArray = new Array();
    for ( var i = 0; i < lines.length; i++ ) {
        if( lines[i] == '' ){
            continue;
        }
        linesArray.push( lines[i] );
    }
    return linesArray;
}

</script>

</html>